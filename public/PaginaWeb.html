<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pollo Express - Tu Pollo Favorito a un Clic</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body id="body">
    
<header class="header">
    <div class="container">
        <a href="#" class="logo">
            Pollo Express üçó
        </a>

        <nav class="nav-main">
            <a href="#menu">Men√∫</a>
            <a href="#seguimiento">Sigue tu Pedido</a>
            <a href="#nosotros">Nosotros</a>
            
            <div id="auth-ui-container">
                
                <a href="login/inicodesesion.html" id="login-link" class="btn btn-secondary">
                    Iniciar Sesi√≥n 
                </a>

                <div id="user-profile-info" class="user-profile-info" style="display: none;"> 
                    <div class="user-avatar" id="user-avatar-placeholder"></div>
                </div>
                
                <div id="profile-dropdown" class="profile-dropdown">
                    
                    <p id="dropdown-welcome"></p> 
                    <p id="dropdown-email"></p>
                    
                    <div id="manage-account-container"></div>
                    
                    <button id="logout-btn">Cerrar Sesi√≥n</button>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main>
        <section class="hero">
            <div class="hero-content">
               <h1>El sabor que te encanta, entregado en minutos.</h1>
                <p>¬øPoco tiempo para cocinar? No te preocupes. Te llevamos a tu puerta nuestro delicioso pollo asado o rostizado, acompa√±ado de papas, frijoles, tortillas y todo lo que necesitas para una comida completa y sin complicaciones. ¬°Ordena ahora y disfruta en casa o en la oficina!</p>
                <a href="#menu" class="btn btn-primary">¬°Pide tu Pollo Ahora!</a>
            </div>
        </section>

        <section id="menu" class="container section">
            <h2 class="section-title">Men√∫ - Ordena por Categor√≠a</h2>
            
            <div class="menu-grid">
                <div class="menu-card list-category">
                    <img src="img/Pollo Imagen.jpg" alt="Pollo Asado y Rostizado">
                    <div class="menu-card-content">
                        <h3>Men√∫</h3>
                        <p>Nuestras especialidades de pollo y complementos principales.</p>
                        <button class="btn btn-secondary open-modal-btn" data-category="pollo">Ver Detalles</button>
                    </div>
                </div>

                <div class="menu-card list-category">
                    <img src="img/Consome imagen.png" alt="Guarniciones y Sopas">
                    <div class="menu-card-content">
                        <h3>Extras</h3>
                        <p>Los acompa√±amientos perfectos para tu comida.</p>
                        <button class="btn btn-secondary open-modal-btn" data-category="extras">Ver Detalles</button>
                    </div>
                </div>

                <div class="menu-card list-category">
                    <img src="img/S.P Pollo imagen.jpg" alt="Ensaladas">
                    <div class="menu-card-content">
                        <h3>Ensaladas y Sopas Fr√≠as</h3>
                        <p>El toque verde y ligero para acompa√±ar tu platillo.</p>
                        <button class="btn btn-secondary open-modal-btn" data-category="ensaladas">Ver Detalles</button>
                    </div>
                </div>

                <div class="menu-card list-category">
                    <img src="img/Bebidas Imagenes.jpeg" alt="Bebidas">
                    <div class="menu-card-content">
                        <h3>ü•§ Bebidas Fr√≠as</h3>
                        <p>Refresca tu paladar con nuestras opciones.</p>
                        <button class="btn btn-secondary open-modal-btn" data-category="bebidas">Ver Detalles</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="seguimiento" class="container section">
            <h2 class="section-title">Sigue tu Pedido en Tiempo Real</h2>
            <div id="tracking-container" class="tracking-container">
                <div id="step-recibido" class="tracking-step active">
                    <div class="step-icon">‚úîÔ∏è</div>
                    <p>Pedido Recibido</p>
                </div>
                <div id="line-1" class="tracking-line"></div>
                <div id="step-preparando" class="tracking-step">
                    <div class="step-icon">üç≥</div>
                    <p>Preparando</p>
                </div>
                <div id="line-2" class="tracking-line"></div>
                <div id="step-camino" class="tracking-step">
                    <div class="step-icon">üèçÔ∏è</div>
                    <p>En Camino</p>
                </div>
                <div id="line-3" class="tracking-line"></div>
                <div id="step-entregado" class="tracking-step">
                    <div class="step-icon">üè†</div>
                    <p>Entregado</p>
                </div>
            </div>
        </section>

        <section id="nosotros" class="section section-dark">
            <div class="container about-us">
                <img src="img/POLLO.png" alt="Chef de Pollo Express" class="about-us-img">
                <div class="about-us-content">
                    <h2 class="section-title">Nuestra Pasi√≥n</h2>
                    <p>En Pollo Pollo, llevamos m√°s de 38 a√±os perfeccionando nuestra **receta secreta**. Nuestro compromiso es simple: ofrecerte el sabor aut√©ntico y un servicio que te haga sentir en casa.</p>
                    <a href="#" class="btn btn-primary" style="margin-top: 20px;">Conoce a Nuestro Equipo</a>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Pollo Express. Todos los derechos reservados.</p>
            <div class="social-links">
                <a href="https://www.facebook.com/pollo.pollo.31.14" target="_blank">Facebook</a>
                <a href="#">Instagram</a>
                <a href="#">WhatsApp</a>
            </div>
        </div>
    </footer>
    
    <a href="CarritoCompras/Carrito.html" id="floating-cart-btn" class="cart-btn">
        üõí
        <span id="floating-cart-badge" class="cart-badge">0</span>
    </a>
    
    <div id="modal-overlay" class="modal-overlay">
        <div id="modal-content" class="modal-content">
            <span class="close-btn">&times;</span>
        </div>
        <div id="menu-detail-pollo" style="display: none;">
            <h3>Men√∫ Principal</h3>
            <div class="modal-item"><div class="item-info"><h4>1 Pollo Asado Completo</h4><p>Incluye frijoles charros, salsa y tortillas.</p></div><span class="item-price">$210.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>1 Pollo Rostizado Completo</h4><p>Incluye frijoles charros, papas, ensalada de repollo y tortillas.</p></div><span class="item-price">$230.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>1/2 Pollo Asado</h4><p>Porci√≥n individual con frijoles charros, salsa y tortillas.</p></div><span class="item-price">$110.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>1/2 Pollo Rostizado</h4><p>Porci√≥n individual con frijoles charros, papas, ensalada de repollo y tortillas.</p></div><span class="item-price">$120.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>Orden de Nuggets (12 pzas)</h4><p>Nuggets de pollo crujientes con tu salsa favorita.</p></div><span class="item-price">$80.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>Orden de Papas a la Francesa</h4><p>Papas fritas crujientes con tu salsa favorita.</p></div><span class="item-price">$50.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>Sopa de tortillas</h4><p>Sopa caliente de tortillas con pollo y especias.</p></div><span class="item-price">$80.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
        </div>
        <div id="menu-detail-extras" style="display: none;">
            <h3>Extras y Acompa√±amientos</h3>
            <div class="modal-item"><div class="item-info"><h4>1/2 Lt Consom√© de Pollo</h4><p>Caldo caliente con sabor.</p></div><span class="item-price">$45.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>1/2 Lt de Frijol Charro</h4><p>Frijoles con tocino y salchicha.</p></div><span class="item-price">$50.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
        </div>
        <div id="menu-detail-ensaladas" style="display: none;">
            <h3>Ensaladas y Sopas Fr√≠as</h3>
            <div class="modal-item"><div class="item-info"><h4>Ensalada de Verdura (Grande)</h4><p>Ensalada fresca de lechuga y tomate.</p></div><span class="item-price">$35.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>Ensalada de Verdura (Chica)</h4><p>Ensalada fresca de lechuga y tomate.</p></div><span class="item-price">$35.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>Ensalada de Pollo</h4><p>Pollo deshebrado, mayonesa, verduras y especias.</p></div><span class="item-price">80.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>Sopa Fr√≠a</h4><p>Crema fr√≠a de codito, servida con crema fresca y un toque de hierbas.</p></div><span class="item-price">$4.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>Ensalada de repollo</h4><p>Repollo crujiente rallado con zanahoria y aderezo ligero, ideal como acompa√±amiento fresco.</p></div><span class="item-price">$30.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>

        </div>
        <div id="menu-detail-bebidas" style="display: none;">
            <h3>Bebidas Refrescantes</h3>
            <div class="modal-item"><div class="item-info"><h4>Refresco (Lata)</h4><p>Coca-Cola, Fanta, Sprite.</p></div><span class="item-price">$20.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
            <div class="modal-item"><div class="item-info"><h4>Agua Natural (600ml)</h4><p>Agua embotellada, fr√≠a.</p></div><span class="item-price">$15.00</span><button class="btn btn-secondary">A√±adir al Carrito</button></div>
        </div>
    </div>
    
 <script type="module">
    import { auth } from './login/js/firebase-config.js';
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

    // Seguimiento del usuario autenticado en esta p√°gina
    let currentUser = null;
    onAuthStateChanged(auth, (user) => {
        currentUser = user;
    });
    // =================================================================
    // 1. L√ìGICA DEL CARRITO (Definiciones Globales)
    // Estas funciones deben estar definidas ANTES de DOMContentLoaded.
    // =================================================================
    let cart = JSON.parse(localStorage.getItem('shoppingCart')) || [];

    const updateCartBadge = () => {
        const badge = document.getElementById('floating-cart-badge');
        if (!badge) return;
        
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        badge.textContent = totalItems;
        badge.parentElement.classList.toggle('active', totalItems > 0);
    };

    const saveCart = () => {
        localStorage.setItem('shoppingCart', JSON.stringify(cart));
        updateCartBadge();
    };

    const addToCart = (product) => {
        const existingProductIndex = cart.findIndex(item => item.id === product.id);
        if (existingProductIndex > -1) {
            cart[existingProductIndex].quantity++;
        } else {
            const description = product.description || 'Delicioso pollo, caliente y listo.'; 
            cart.push({ ...product, quantity: 1, description: description });
        }
        saveCart();
    };

    const closeModal = () => {
        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');
        const body = document.getElementById('body');

        if (modalOverlay) modalOverlay.classList.remove('active');
        if (body) body.classList.remove('modal-open');

        const activeDetail = modalContent ? modalContent.querySelector('[id^="menu-detail-"]') : null;
        if (activeDetail && modalOverlay) {
            modalOverlay.appendChild(activeDetail);
            activeDetail.style.display = 'none';
        }
    };


    // =================================================================
    // 2. L√ìGICA PRINCIPAL (Ejecuci√≥n al cargar la p√°gina)
    // =================================================================
    document.addEventListener('DOMContentLoaded', () => {
        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');
        const openModalBtns = document.querySelectorAll('.open-modal-btn');
        const body = document.getElementById('body');
        
        const menuDetails = {
            'pollo': document.getElementById('menu-detail-pollo'),
            'extras': document.getElementById('menu-detail-extras'),
            'ensaladas': document.getElementById('menu-detail-ensaladas'),
            'bebidas': document.getElementById('menu-detail-bebidas'),
        };

        // --- EVENTO: A√±adir al Carrito Y Cerrar Modal ---
        if (modalOverlay) {
            modalOverlay.addEventListener('click', (e) => {
                const clickedElement = e.target;
                const targetText = clickedElement.textContent.trim();
                
                // L√≥gica A√±adir al Carrito
                if (clickedElement.classList.contains('btn-secondary') && targetText === 'A√±adir al Carrito') {
                    // Si no hay usuario autenticado, redirigir al login
                    if (!currentUser) {
                        alert('Debes iniciar sesi√≥n para a√±adir productos al carrito. Ser√°s redirigido al inicio de sesi√≥n.');
                        window.location.href = 'login/inicodesesion.html';
                        return; // evitar a√±adir al carrito
                    }
                    
                    const modalItem = clickedElement.closest('.modal-item');
                    if (!modalItem) return;

                    const name = modalItem.querySelector('h4').textContent.trim();
                    const description = modalItem.querySelector('p').textContent.trim(); 
                    
                    // Usamos parseFloat() o Number() para el precio
                    const priceText = modalItem.querySelector('.item-price').textContent.replace('$', '').trim();
                    const price = parseFloat(priceText); 
                    const id = name.replace(/[^\w]/g, '').toLowerCase(); 
                    
                    addToCart({ id, name, price, description }); 

                    // Efecto visual
                    clickedElement.textContent = '¬°A√±adido! ‚úÖ';
                    clickedElement.disabled = true; 
                    setTimeout(() => {
                        clickedElement.textContent = 'A√±adir al Carrito';
                        clickedElement.disabled = false;
                    }, 1000);
                    
                    e.stopPropagation(); 
                } 
                
                // L√≥gica Cerrar Modal
                else if (clickedElement === modalOverlay || clickedElement.classList.contains('close-btn')) {
                    closeModal();
                }
            });
        }


        // --- L√≥gica para abrir el modal ---
        openModalBtns.forEach(button => {
            button.addEventListener('click', (e) => {
                const category = e.currentTarget.getAttribute('data-category');
                
                Object.values(menuDetails).forEach(detail => {
                    if (detail) {
                        detail.style.display = 'none';
                        modalOverlay.appendChild(detail); 
                    }
                });
                
                if (menuDetails[category]) {
                    modalContent.appendChild(menuDetails[category]);
                    menuDetails[category].style.display = 'block';
                }
                modalOverlay.classList.add('active');
                body.classList.add('modal-open');
            });
        });

        // --- Otros Eventos ---
        const scrollThreshold = 50;
        window.addEventListener('scroll', () => body.classList.toggle('scrolled', window.scrollY > scrollThreshold));
        
        updateCartBadge();
    });
</script>
<script src="js/main-auth.js" type="module"></script>
</body>
</html>